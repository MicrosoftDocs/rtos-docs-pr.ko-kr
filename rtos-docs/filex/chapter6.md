---
title: 6장 - Azure RTOS FileX 내결함성 모듈
description: 이 장에는 미디어의 전원이 꺼지거나 파일 쓰기 작업 도중 배출되는 경우 파일 시스템 무결성을 유지하기 위해 설계된 Azure RTOS FileX 내결함성 모듈에 대한 설명이 포함되어 있습니다.
author: philmea
ms.author: philmea
ms.date: 05/19/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: 68a24f0345a2c4d3e824270699b00a2daab32f8e
ms.sourcegitcommit: e3d42e1f2920ec9cb002634b542bc20754f9544e
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/22/2021
ms.locfileid: "104811322"
---
# <a name="chapter-6---azure-rtos-filex-fault-tolerant-module"></a><span data-ttu-id="3c842-103">6장 - Azure RTOS FileX 내결함성 모듈</span><span class="sxs-lookup"><span data-stu-id="3c842-103">Chapter 6 - Azure RTOS FileX fault tolerant module</span></span>

<span data-ttu-id="3c842-104">이 장에는 미디어의 전원이 꺼지거나 파일 쓰기 작업 도중 배출되는 경우 파일 시스템 무결성을 유지하기 위해 설계된 Azure RTOS FileX 내결함성 모듈에 대한 설명이 포함되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-104">This chapter contains a description of the Azure RTOS FileX Fault Tolerant Module that is designed to maintain file system integrity if the media loses power or is ejected in the middle of a file write operation.</span></span>

## <a name="filex-fault-tolerant-module-overview"></a><span data-ttu-id="3c842-105">FileX 내결함성 모듈 개요</span><span class="sxs-lookup"><span data-stu-id="3c842-105">FileX Fault Tolerant Module Overview</span></span>

<span data-ttu-id="3c842-106">애플리케이션이 파일에 데이터를 쓸 때 FileX는 데이터 클러스터와 시스템 정보를 모두 업데이트합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-106">When an application writes data into a file, FileX updates both data clusters and system information.</span></span> <span data-ttu-id="3c842-107">이러한 업데이트는 파일 시스템의 정보를 일관되게 유지하는 원자성 작업으로 완료되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-107">These updates must be completed as an atomic operation to keep information in the file system coherent.</span></span> <span data-ttu-id="3c842-108">예를 들어, 파일에 데이터를 추가할 때 FileX는 미디어에서 사용 가능한 클러스터를 찾고, FAT 체인을 업데이트하고, 디렉터리 항목에 기록되는 길이를 업데이트하고, 디렉터리 항목에서 시작 클러스터 번호를 업데이트해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-108">For example, when appending data to a file, FileX needs to find an available cluster in the media, update the FAT chain, update the length filed in the directory entry, and possibly update the starting cluster number in the directory entry.</span></span> <span data-ttu-id="3c842-109">전원 오류나 미디어 배출로 인해 업데이트 시퀀스가 중단될 수 있으며, 이로 인해 파일 시스템이 일관되지 않은 상태가 됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-109">Either a power failure or media ejection can interrupt the sequence of updates, which will leave the file system in an inconsistent state.</span></span> <span data-ttu-id="3c842-110">일관되지 않은 상태가 교정되지 않으면 업데이트되는 데이터가 손실될 수 있으며, 시스템 정보 손상으로 인해 후속 파일 시스템 작업 시 미디어의 다른 파일 또는 디렉터리가 손상될 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-110">If the inconsistent state is not corrected, the data being updated can be lost, and because of damage to the system information, subsequent file system operation may damage other files or directories on the media.</span></span>

<span data-ttu-id="3c842-111">FileX 내결함성 모듈은 파일 시스템에 이러한 단계를 적용하기 *전에* 파일 업데이트에 필요한 저널링 단계를 따라 작동합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-111">The FileX Fault Tolerant Module works by journaling steps required to update a file *before* these steps are applied to the file system.</span></span> <span data-ttu-id="3c842-112">파일 업데이트에 성공하면 로그 항목이 제거됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-112">If the file update is successful, these log entries are removed.</span></span> <span data-ttu-id="3c842-113">하지만 파일 업데이트가 중단되면 로그 항목이 미디어에 저장됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-113">However, if the file update is interrupted, the log entries are stored on the media.</span></span> <span data-ttu-id="3c842-114">다음 번에 미디어가 탑재될 때 FileX는 이전의(완료되지 않은) 쓰기 작업에서 이러한 로그 항목을 검색합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-114">Next time the media is mounted, FileX detects these log entries from the previous (unfinished) write operation.</span></span> <span data-ttu-id="3c842-115">이러한 경우 FileX는 파일 시스템에 이미 적용된 변경 사항을 롤백하거나 이전 작업을 완료하는 데 필요한 변경 사항을 다시 적용하여 오류를 복구할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-115">In such cases, FileX can recover from a failure by either rolling back the changes already made to the file system, or by reapplying the required changes to complete the previous operation.</span></span> <span data-ttu-id="3c842-116">이러한 방식으로 업데이트 작업 중에 미디어 전원이 꺼진 경우 FileX 내결함성 모듈은 파일 시스템 무결성을 유지합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-116">In this way, the FileX Fault Tolerant Module maintains file system integrity if the media loses power during an update operation.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="3c842-117">*FileX 내결함성 모듈은 유효한 데이터가 포함된 물리적 미디어 손상으로 인해 발생하는 파일 시스템 손상을 방지하도록 설계되지 않았습니다.*</span><span class="sxs-lookup"><span data-stu-id="3c842-117">*The FileX Fault Tolerant Module is not designed to prevent file system corruption caused by physical media corruption with valid data in it.*</span></span>

> [!IMPORTANT]
> <span data-ttu-id="3c842-118">*FileX 내결함성 모듈이 미디어를 보호한 후에는 내결함성 사용이 설정된 FileX 이외의 방법을 통해 미디어를 탑재해서는 안 됩니다. 이렇게 하면 파일 시스템의 로그 항목이 미디어의 시스템 정보와 일치하지 않을 수 있습니다. 다른 파일 시스템에서 미디어를 업데이트한 이후 FileX 내결함성 모듈에서 로그 항목을 처리하려고 하면 복구 절차가 실패하여 전체 파일 시스템이 예측할 수 없는 상태가 될 수 있습니다.*</span><span class="sxs-lookup"><span data-stu-id="3c842-118">*After the FileX Fault Tolerant module protects a media, the media must not be mounted by anything other than FileX with Fault Tolerant enabled. Doing so can cause the log entries in the file system to be inconsistent with system information on the media. If the FileX Fault Tolerant module attempts to process log entries after the media is updated by another file system, the recovery procedure may fail, leaving the entire file system in an unpredictable state.*</span></span>

## <a name="use-of-the-fault-tolerant-module"></a><span data-ttu-id="3c842-119">내결함성 모듈 사용</span><span class="sxs-lookup"><span data-stu-id="3c842-119">Use of the Fault Tolerant Module</span></span>

<span data-ttu-id="3c842-120">FileX 내결함성 기능은 FileX에서 지원하는 모든 FAT 파일 시스템(FAT12, FAT16, FAT32, exFAT 등)에서 사용할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-120">The FileX Fault Tolerant feature is available to all FAT file systems supported by FileX, including FAT12, FAT16, FAT32, and exFAT.</span></span> <span data-ttu-id="3c842-121">내결함성 기능을 사용하도록 설정하려면 **FX_ENABLE_FAULT_TOLERANT** 기호가 정의된 FileX가 빌드되어야 합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-121">To enable the fault tolerant feature, FileX must be built with the symbol **FX_ENABLE_FAULT_TOLERANT** defined.</span></span> <span data-ttu-id="3c842-122">런타임에서 애플리케이션은 **_fx_fault_tolerant_enable_ *_을 호출(_* _fx_media_open_** 호출 직후)하여 내결함성 서비스를 시작합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-122">At run time, application starts fault tolerant service by calling **_fx_fault_tolerant_enable_*_ immediately after the call to _*_fx_media_open_**.</span></span> <span data-ttu-id="3c842-123">내결함성 서비스를 사용한 후에는 지정된 미디어에 대한 모든 파일 쓰기 작업이 보호됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-123">After fault tolerant is enabled, all file write operations to the designated media are protected.</span></span> <span data-ttu-id="3c842-124">기본적으로 내결함성 모듈은 사용하도록 설정되어 있지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-124">By default the fault tolerant module is not enabled.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="3c842-125">\*애플리케이션에서 \***fx_fault_tolerant_enable** _ 호출 전에 파일 시스템이 액세스되지 않는지 확인해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-125">\*Application needs to make sure the file system is not being accessed prior to \***fx_fault_tolerant_enable** _ being called.</span></span> <span data-ttu-id="3c842-126">내결함성을 사용하도록 설정하기 전에 애플리케이션에서 파일 시스템에 데이터를 쓰는 경우 이전 쓰기 작업이 완료되지 않으면 쓰기 작업 시 미디어가 손상될 수 있으며, 파일 시스템은 내결함성 로그 항목을 사용하여 복구되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-126">If application writes data to the file system prior to fault tolerant enable, the write operation could corrupt the media if prior write operations were not completed, and the file system was not restored using fault tolerant log entries._</span></span>

## <a name="filex-fault-tolerant-module-log"></a><span data-ttu-id="3c842-127">FileX 내결함성 모듈 로그</span><span class="sxs-lookup"><span data-stu-id="3c842-127">FileX Fault Tolerant Module Log</span></span>

<span data-ttu-id="3c842-128">FileX 내결함성 로그는 플래시에서 하나의 논리 클러스터를 차지합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-128">The FileX fault tolerant log takes up one logical cluster in flash.</span></span> <span data-ttu-id="3c842-129">해당 클러스터의 시작 클러스터 번호에 대한 인덱스가 미디어의 부트 섹터에서 기록되고, **FX_FAULT_TOLERANT_BOOT_INDEX** 기호에 의해 오프셋이 지정됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-129">The index to the starting cluster number of that cluster is recorded in the boot sector of the media, with an offset specified by the symbol **FX_FAULT_TOLERANT_BOOT_INDEX**.</span></span> <span data-ttu-id="3c842-130">기본적으로 이 기호는 116으로 정의됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-130">By default this symbol is defined to be 116.</span></span> <span data-ttu-id="3c842-131">FAT12/16/32 및 exFAT 사양에서 예약된 것으로 표시되기 때문에 이 위치가 선택됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-131">This location is chosen because it is marked as reserved in FAT12/ 16/32 and exFAT specification.</span></span>

<span data-ttu-id="3c842-132">그림 5, "로그 구조 레이아웃"은 로그 구조의 일반적인 레이아웃을 보여줍니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-132">Figure 5, "Log Structure Layout," shows the general layout of the log structure.</span></span> <span data-ttu-id="3c842-133">로그 구조는 로그 헤더, FAT 체인 및 로그 항목의 세 가지 섹션으로 구성되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-133">The log structure contains three sections: Log Header, FAT Chain, and Log Entries.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="3c842-134">*로그 항목에 저장된 모든 멀티바이트 값은 Little Endian 형식입니다.*</span><span class="sxs-lookup"><span data-stu-id="3c842-134">*All multi-byte values stored in the log entries are in Little Endian format.*</span></span>

![로그 구조 레이아웃](./media/user-guide/log-structure-layout.png)

<span data-ttu-id="3c842-136">**그림 5. 로그 구조 레이아웃**</span><span class="sxs-lookup"><span data-stu-id="3c842-136">**Figure 5. Log Structure Layout**</span></span>

<span data-ttu-id="3c842-137">로그 헤더 영역에는 전체 로그 구조를 설명하고 각 필드에 대해 자세히 설명하는 정보가 포함되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-137">The Log Header area contains information that describes the entire log structure and explains each field in detail.</span></span>

<span data-ttu-id="3c842-138">**표 8. 로그 헤더 영역**</span><span class="sxs-lookup"><span data-stu-id="3c842-138">**TABLE 8. Log Header Area**</span></span>

|<span data-ttu-id="3c842-139">필드</span><span class="sxs-lookup"><span data-stu-id="3c842-139">Field</span></span>|<span data-ttu-id="3c842-140">크기(바이트)</span><span class="sxs-lookup"><span data-stu-id="3c842-140">Size(in bytes)</span></span>|<span data-ttu-id="3c842-141">Description</span><span class="sxs-lookup"><span data-stu-id="3c842-141">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="3c842-142">ID</span><span class="sxs-lookup"><span data-stu-id="3c842-142">ID</span></span>|<span data-ttu-id="3c842-143">4</span><span class="sxs-lookup"><span data-stu-id="3c842-143">4</span></span>|<span data-ttu-id="3c842-144">FileX 내결함성 로그 구조를 식별합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-144">Identifies a FileX Fault Tolerant Log structure.</span></span> <span data-ttu-id="3c842-145">ID 값이 0x46544C52가 아닌 경우 로그 구조가 잘못된 것으로 간주됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-145">The log structure is considered invalid if the ID value is not 0x46544C52.</span></span>|
|<span data-ttu-id="3c842-146">전체 크기</span><span class="sxs-lookup"><span data-stu-id="3c842-146">Total Size</span></span>|<span data-ttu-id="3c842-147">2</span><span class="sxs-lookup"><span data-stu-id="3c842-147">2</span></span>|<span data-ttu-id="3c842-148">전체 로그 구조의 전체 크기(바이트)를 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-148">Indicates the total size (in bytes) of the entire log structure.</span></span>|
|<span data-ttu-id="3c842-149">헤더 체크섬</span><span class="sxs-lookup"><span data-stu-id="3c842-149">Header Checksum</span></span>|<span data-ttu-id="3c842-150">2</span><span class="sxs-lookup"><span data-stu-id="3c842-150">2</span></span>|<span data-ttu-id="3c842-151">로그 헤더 영역을 변환하는 체크섬입니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-151">Checksum that converts the log header area.</span></span> <span data-ttu-id="3c842-152">헤더 필드가 체크섬 확인에 실패하는 경우 로그 구조가 잘못된 것으로 간주됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-152">The log structure is considered invalid if the header fields fail the checksum verification.</span></span>|
|<span data-ttu-id="3c842-153">버전 번호</span><span class="sxs-lookup"><span data-stu-id="3c842-153">Version Number</span></span>|<span data-ttu-id="3c842-154">2</span><span class="sxs-lookup"><span data-stu-id="3c842-154">2</span></span>|<span data-ttu-id="3c842-155">FileX 내결함성 주 버전 번호 및 부 버전 번호입니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-155">FileX Fault Tolerant major and minor version numbers.</span></span>|
|<span data-ttu-id="3c842-156">예약됨</span><span class="sxs-lookup"><span data-stu-id="3c842-156">Reserved</span></span>|<span data-ttu-id="3c842-157">2</span><span class="sxs-lookup"><span data-stu-id="3c842-157">2</span></span>|<span data-ttu-id="3c842-158">향후 확장용입니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-158">For future expansion.</span></span>|

<span data-ttu-id="3c842-159">로그 헤더 영역 뒤에는 FAT 체인 로그 영역이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-159">The Log Header area is followed by the FAT Chain Log area.</span></span> <span data-ttu-id="3c842-160">그림 9에는 FAT 체인을 수정하는 방법을 설명하는 정보가 포함되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-160">Figure 9 contains information that describes how the FAT chain should be modified.</span></span> <span data-ttu-id="3c842-161">이 로그 영역에는 파일에 할당되는 클러스터, 파일에서 제거되는 클러스터, 삽입/삭제가 이루어져야 하는 위치에 관한 정보가 포함되고, FAT 체인 로그 영역의 각 필드를 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-161">This log area contains information on the clusters being allocated to a file, the clusters being removed from a file, and where the insertion/deletion should be and describes each field in the FAT Chain Log area.</span></span>

<span data-ttu-id="3c842-162">**표 9. FAT 체인 로그 영역**</span><span class="sxs-lookup"><span data-stu-id="3c842-162">**TABLE 9. FAT Chain Log Area**</span></span>

|<span data-ttu-id="3c842-163">필드</span><span class="sxs-lookup"><span data-stu-id="3c842-163">Field</span></span>|<span data-ttu-id="3c842-164">크기(바이트)</span><span class="sxs-lookup"><span data-stu-id="3c842-164">Size(in bytes)</span></span>|<span data-ttu-id="3c842-165">Description</span><span class="sxs-lookup"><span data-stu-id="3c842-165">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="3c842-166">FAT 체인 로그 체크섬</span><span class="sxs-lookup"><span data-stu-id="3c842-166">FAT Chain Log Checksum</span></span>|<span data-ttu-id="3c842-167">2</span><span class="sxs-lookup"><span data-stu-id="3c842-167">2</span></span>|<span data-ttu-id="3c842-168">전체 FAT 체인 로그 영역의 체크섬입니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-168">Checksum of the entire FAT Chain Log area.</span></span> <span data-ttu-id="3c842-169">체크섬 확인에 실패하는 경우 FAT 체인 로그 영역은 잘못된 것으로 간주됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-169">The FAT Chain Log area is considered invalid if the it fails the checksum verification.</span></span>|
|<span data-ttu-id="3c842-170">플래그</span><span class="sxs-lookup"><span data-stu-id="3c842-170">Flag</span></span>|<span data-ttu-id="3c842-171">1</span><span class="sxs-lookup"><span data-stu-id="3c842-171">1</span></span>|<span data-ttu-id="3c842-172">유효한 플래그는 다음과 같습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-172">Valid flag values are:</span></span><br/><span data-ttu-id="3c842-173">0x01 FAT 체인 유효함</span><span class="sxs-lookup"><span data-stu-id="3c842-173">0x01 FAT Chain Valid</span></span><br /><span data-ttu-id="3c842-174">0x02 비트맵 사용 중</span><span class="sxs-lookup"><span data-stu-id="3c842-174">0x02 BITMAP is being used</span></span>|
|<span data-ttu-id="3c842-175">예약됨</span><span class="sxs-lookup"><span data-stu-id="3c842-175">Reserved</span></span>|<span data-ttu-id="3c842-176">1</span><span class="sxs-lookup"><span data-stu-id="3c842-176">1</span></span>|<span data-ttu-id="3c842-177">나중에 사용하도록 예약되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-177">Reserved for future use</span></span>|
|<span data-ttu-id="3c842-178">삽입 지점 – 전면</span><span class="sxs-lookup"><span data-stu-id="3c842-178">Insertion Point – Front</span></span>|<span data-ttu-id="3c842-179">4</span><span class="sxs-lookup"><span data-stu-id="3c842-179">4</span></span>|<span data-ttu-id="3c842-180">새로 만든 체인이 연결될 클러스터(원래 FAT 체인에 속함).</span><span class="sxs-lookup"><span data-stu-id="3c842-180">The cluster (that belongs to the original FAT chain) where the newly created chain is going to be attached to.</span></span>|
|<span data-ttu-id="3c842-181">새 FAT 체인의 헤드 클러스터</span><span class="sxs-lookup"><span data-stu-id="3c842-181">Head Cluster of New FAT Chain</span></span>|<span data-ttu-id="3c842-182">4</span><span class="sxs-lookup"><span data-stu-id="3c842-182">4</span></span>|<span data-ttu-id="3c842-183">새로 만든 FAT 체인의 첫 번째 클러스터</span><span class="sxs-lookup"><span data-stu-id="3c842-183">The first cluster of the newly created FAT Chain</span></span>|
|<span data-ttu-id="3c842-184">원래 FAT 체인의 헤드 클러스터</span><span class="sxs-lookup"><span data-stu-id="3c842-184">Head Cluster of Original FAT Chain</span></span>|<span data-ttu-id="3c842-185">4</span><span class="sxs-lookup"><span data-stu-id="3c842-185">4</span></span>|<span data-ttu-id="3c842-186">제거할 원래 FAT 체인 부분의 첫 번째 클러스터입니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-186">The first cluster of the portion of the original FAT Chain that is to be removed.</span></span>|
|<span data-ttu-id="3c842-187">삽입 지점 - 후면</span><span class="sxs-lookup"><span data-stu-id="3c842-187">Insertion Point – Back</span></span>|<span data-ttu-id="3c842-188">4</span><span class="sxs-lookup"><span data-stu-id="3c842-188">4</span></span>|<span data-ttu-id="3c842-189">새로 만든 FAT 체인이 조인하는 원래 클러스터입니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-189">The original cluster where the newly created FAT chain joins at.</span></span>|
|<span data-ttu-id="3c842-190">다음 삭제 지점</span><span class="sxs-lookup"><span data-stu-id="3c842-190">Next Deletion Point</span></span>|<span data-ttu-id="3c842-191">4</span><span class="sxs-lookup"><span data-stu-id="3c842-191">4</span></span>|<span data-ttu-id="3c842-192">이 필드는 FAT 체인 정리 프로시저를 지원합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-192">This field assists the FAT chain cleanup procedure.</span></span>|

<span data-ttu-id="3c842-193">로그 항목 영역에는 오류를 복구하는 데 필요한 변경 사항을 설명하는 로그 항목이 포함되어 있습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-193">The Log Entries Area contains log entries that describe the changes needed to recover from a failure.</span></span> <span data-ttu-id="3c842-194">FileX 내결함성 모듈에서 지원하는 로그 항목에는 FAT 로그 항목, 디렉터리 로그 항목, 비트맵 로그 항목의 세 가지 유형이 있습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-194">There are three types of log entry supported in the FileX fault tolerant module: FAT Log Entry; Directory Log Entry; and Bitmap Log Entry.</span></span>

<span data-ttu-id="3c842-195">다음 3개의 그림 및 표는 이러한 로그 항목을 자세히 설명합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-195">The following three figures and three tables describe these log entries in detail.</span></span>

![FAT 로그 항목](./media/user-guide/fat-log-entry.png)

<span data-ttu-id="3c842-197">**그림 6. FAT 로그 항목**</span><span class="sxs-lookup"><span data-stu-id="3c842-197">**Figure 6. FAT Log Entry**</span></span>

<span data-ttu-id="3c842-198">**표 10. FAT 로그 항목**</span><span class="sxs-lookup"><span data-stu-id="3c842-198">**TABLE 10. FAT Log Entry**</span></span>

|<span data-ttu-id="3c842-199">필드</span><span class="sxs-lookup"><span data-stu-id="3c842-199">Field</span></span>|<span data-ttu-id="3c842-200">크기(바이트)</span><span class="sxs-lookup"><span data-stu-id="3c842-200">Size(in bytes)</span></span>|<span data-ttu-id="3c842-201">Description</span><span class="sxs-lookup"><span data-stu-id="3c842-201">Description</span></span>|
|-----|--------------|-----------|
<span data-ttu-id="3c842-202">Type</span><span class="sxs-lookup"><span data-stu-id="3c842-202">Type</span></span>|<span data-ttu-id="3c842-203">2</span><span class="sxs-lookup"><span data-stu-id="3c842-203">2</span></span>|<span data-ttu-id="3c842-204">항목의 유형(FX_FAULT_TOLERANT_FAT_LOG_TYPE이어야 함)</span><span class="sxs-lookup"><span data-stu-id="3c842-204">Type of Entry, must be FX_FAULT_TOLERANT_FAT_LOG_TYPE</span></span>|
|<span data-ttu-id="3c842-205">크기</span><span class="sxs-lookup"><span data-stu-id="3c842-205">Size</span></span>|<span data-ttu-id="3c842-206">2</span><span class="sxs-lookup"><span data-stu-id="3c842-206">2</span></span>|<span data-ttu-id="3c842-207">이 항목의 크기</span><span class="sxs-lookup"><span data-stu-id="3c842-207">Size of this entry</span></span>|
|<span data-ttu-id="3c842-208">클러스터 번호</span><span class="sxs-lookup"><span data-stu-id="3c842-208">Cluster Number</span></span>|<span data-ttu-id="3c842-209">4</span><span class="sxs-lookup"><span data-stu-id="3c842-209">4</span></span>|<span data-ttu-id="3c842-210">클러스터 번호</span><span class="sxs-lookup"><span data-stu-id="3c842-210">Cluster number</span></span>|
|<span data-ttu-id="3c842-211">값</span><span class="sxs-lookup"><span data-stu-id="3c842-211">Value</span></span>|<span data-ttu-id="3c842-212">4</span><span class="sxs-lookup"><span data-stu-id="3c842-212">4</span></span>|<span data-ttu-id="3c842-213">FAT 항목에 쓸 값</span><span class="sxs-lookup"><span data-stu-id="3c842-213">Value to be written into the FAT entry</span></span>|

![디렉터리 로그 항목](./media/user-guide/directory-log-entry.png)

<span data-ttu-id="3c842-215">**그림 7. 디렉터리 로그 항목**</span><span class="sxs-lookup"><span data-stu-id="3c842-215">**Figure 7. Directory Log Entry**</span></span>

<span data-ttu-id="3c842-216">**표 11. 디렉터리 로그 항목**</span><span class="sxs-lookup"><span data-stu-id="3c842-216">**TABLE 11. Directory Log Entry**</span></span>

|<span data-ttu-id="3c842-217">필드</span><span class="sxs-lookup"><span data-stu-id="3c842-217">Field</span></span>|<span data-ttu-id="3c842-218">크기(바이트)</span><span class="sxs-lookup"><span data-stu-id="3c842-218">Size(in bytes)</span></span>|<span data-ttu-id="3c842-219">Description</span><span class="sxs-lookup"><span data-stu-id="3c842-219">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="3c842-220">Type</span><span class="sxs-lookup"><span data-stu-id="3c842-220">Type</span></span>|<span data-ttu-id="3c842-221">2</span><span class="sxs-lookup"><span data-stu-id="3c842-221">2</span></span>|<span data-ttu-id="3c842-222">항목의 유형(FX_FAULT_TOLERANT_DIRECTORY_LOG_TYPE이어야 함)</span><span class="sxs-lookup"><span data-stu-id="3c842-222">Type of Entry, must be FX_FAULT_TOLERANT_DIRECTORY_LOG_TYPE</span></span>|
|<span data-ttu-id="3c842-223">크기</span><span class="sxs-lookup"><span data-stu-id="3c842-223">Size</span></span>|<span data-ttu-id="3c842-224">2</span><span class="sxs-lookup"><span data-stu-id="3c842-224">2</span></span>|<span data-ttu-id="3c842-225">이 항목의 크기</span><span class="sxs-lookup"><span data-stu-id="3c842-225">Size of this entry</span></span>|
|<span data-ttu-id="3c842-226">섹터 오프셋</span><span class="sxs-lookup"><span data-stu-id="3c842-226">Sector Offset</span></span>|<span data-ttu-id="3c842-227">4</span><span class="sxs-lookup"><span data-stu-id="3c842-227">4</span></span>|<span data-ttu-id="3c842-228">이 디렉터리가 있는 섹터의 오프셋(바이트)입니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-228">Offset (in bytes) into the sector where this directory is located.</span></span>|
|<span data-ttu-id="3c842-229">로그 섹터</span><span class="sxs-lookup"><span data-stu-id="3c842-229">Log Sector</span></span>|<span data-ttu-id="3c842-230">4</span><span class="sxs-lookup"><span data-stu-id="3c842-230">4</span></span>|<span data-ttu-id="3c842-231">디렉터리 항목이 있는 섹터입니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-231">The sector where the directory entry is located</span></span>|
|<span data-ttu-id="3c842-232">로그 데이터</span><span class="sxs-lookup"><span data-stu-id="3c842-232">Log Data</span></span>|<span data-ttu-id="3c842-233">변수</span><span class="sxs-lookup"><span data-stu-id="3c842-233">Variable</span></span>|<span data-ttu-id="3c842-234">디렉터리 항목의 내용</span><span class="sxs-lookup"><span data-stu-id="3c842-234">Content of the directory entry</span></span>|

![비트맵 로그 항목](./media/user-guide/bitmap-log-entry.png)

<span data-ttu-id="3c842-236">**그림 8. 비트맵 로그 항목**</span><span class="sxs-lookup"><span data-stu-id="3c842-236">**Figure 8. Bitmap Log Entry**</span></span>

<span data-ttu-id="3c842-237">**표 12. 비트맵 로그 항목**</span><span class="sxs-lookup"><span data-stu-id="3c842-237">**TABLE 12. Bitmap Log Entry**</span></span>

|<span data-ttu-id="3c842-238">필드</span><span class="sxs-lookup"><span data-stu-id="3c842-238">Field</span></span>|<span data-ttu-id="3c842-239">크기(바이트)</span><span class="sxs-lookup"><span data-stu-id="3c842-239">Size(in bytes)</span></span>|<span data-ttu-id="3c842-240">Description</span><span class="sxs-lookup"><span data-stu-id="3c842-240">Description</span></span>|
|-----|--------------|-----------|
|<span data-ttu-id="3c842-241">Type</span><span class="sxs-lookup"><span data-stu-id="3c842-241">Type</span></span>|<span data-ttu-id="3c842-242">2</span><span class="sxs-lookup"><span data-stu-id="3c842-242">2</span></span>|<span data-ttu-id="3c842-243">항목의 유형(FX_FAULT_TOLERANT_BITMAP_LOG_TYPE이어야 함)</span><span class="sxs-lookup"><span data-stu-id="3c842-243">Type of Entry, must be FX_FAULT_TOLERANT_BITMAP_LOG_TYPE</span></span>|
|<span data-ttu-id="3c842-244">크기</span><span class="sxs-lookup"><span data-stu-id="3c842-244">Size</span></span>|<span data-ttu-id="3c842-245">2</span><span class="sxs-lookup"><span data-stu-id="3c842-245">2</span></span>|<span data-ttu-id="3c842-246">이 항목의 크기</span><span class="sxs-lookup"><span data-stu-id="3c842-246">Size of this entry</span></span>|
|<span data-ttu-id="3c842-247">클러스터 번호</span><span class="sxs-lookup"><span data-stu-id="3c842-247">Cluster Number</span></span>|<span data-ttu-id="3c842-248">4</span><span class="sxs-lookup"><span data-stu-id="3c842-248">4</span></span>|<span data-ttu-id="3c842-249">클러스터 번호</span><span class="sxs-lookup"><span data-stu-id="3c842-249">Cluster number</span></span>|
|<span data-ttu-id="3c842-250">값</span><span class="sxs-lookup"><span data-stu-id="3c842-250">Value</span></span>|<span data-ttu-id="3c842-251">4</span><span class="sxs-lookup"><span data-stu-id="3c842-251">4</span></span>|<span data-ttu-id="3c842-252">FAT 항목에 쓸 값</span><span class="sxs-lookup"><span data-stu-id="3c842-252">Value to be written into the FAT entry</span></span>|

## <a name="fault-tolerant-protection"></a><span data-ttu-id="3c842-253">내결함성 보호</span><span class="sxs-lookup"><span data-stu-id="3c842-253">Fault Tolerant Protection</span></span>

<span data-ttu-id="3c842-254">FileX 내결함성 모듈은 시작 후 먼저 미디어에서 기존 내결함성 로그 파일을 검색합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-254">After the FileX Fault Tolerant Module starts, it first searches for an existing fault tolerant log file in the media.</span></span> <span data-ttu-id="3c842-255">유효한 로그 파일을 찾을 수 없는 경우 FileX는 미디어를 보호되지 않는 미디어로 간주합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-255">If a valid log file cannot be found, FileX considers the media unprotected.</span></span> <span data-ttu-id="3c842-256">이 경우 FileX는 미디어에 내결함성 로그 파일을 만듭니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-256">In this case FileX will create a fault tolerant log file on the media.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="3c842-257">\*FileX 내결함성 모듈 시작 전에 파일 시스템이 손상된 경우 FileX는 파일 시스템을 보호할 수 없습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-257">\*FileX is not able to protect a file system if it was corrupted before the FileX Fault Tolerant Module starts.</span></span> *

<span data-ttu-id="3c842-258">내결함성 로그 파일이 있는 경우 FileX는 기존 로그 항목을 확인합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-258">If a fault tolerant log file is located, FileX checks for existing log entries.</span></span> <span data-ttu-id="3c842-259">로그 항목이 없는 로그 파일은 이전 파일 작업이 성공적이며 모든 로그 항목이 제거되었음을 나타냅니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-259">A log file with no log entry indicates prior file operation was successful, and all log entries were removed.</span></span> <span data-ttu-id="3c842-260">이 경우 애플리케이션은 내결함성 보호가 포함된 파일 시스템 사용을 시작할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-260">In this case the application can start using the file system with fault tolerant protection.</span></span>

<span data-ttu-id="3c842-261">하지만 로그 항목이 있는 경우 FileX는 이전 파일 작업을 완료하거나 파일 시스템에 이미 적용된 변경 사항을 되돌려야 하므로 실질적으로는 변경 사항을 취소해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-261">However if log entries are located, FileX needs to either complete the prior file operation, or revert the changes already applied to the file system, effectively undo the changes.</span></span> <span data-ttu-id="3c842-262">두 경우 모두 파일 시스템에 로그 항목이 적용된 후 파일 시스템은 일관된 상태로 복원되며, 애플리케이션은 파일 시스템을 다시 사용하여 시작할 수 있습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-262">In either case, after the log entries are applied to the file system, the file system is restored into a coherent state, and application can start using the file system again.</span></span>

<span data-ttu-id="3c842-263">FileX로 보호되는 미디어의 경우 파일 업데이트 작업 도중 데이터 부분을 미디어에 직접 쓰게 됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-263">For media protected by FileX, during file update operation, the data portion is written directly to the media.</span></span> <span data-ttu-id="3c842-264">FileX는 데이터를 쓰고, 디렉터리 항목, FAT 테이블에 적용해야 하는 변경 사항도 기록합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-264">As FileX writes data, it also records any changes needed to be applied to directory entries, FAT table.</span></span> <span data-ttu-id="3c842-265">이 정보는 파일 허용 로그 항목에 기록됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-265">This information is recorded in the file tolerant log entries.</span></span> <span data-ttu-id="3c842-266">이 방법을 사용하면 데이터를 미디어에 쓴 이후 파일 시스템에 대한 업데이트가 보장됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-266">This approach guarantees that updates to the file system occur after the data is written to the media.</span></span> <span data-ttu-id="3c842-267">데이터 쓰기 단계에서 미디어를 꺼낼 경우 중요한 파일 시스템 정보가 아직 변경되지 않게 됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-267">If the media is ejected during the data-write phase, crucial file system information has not been changed yet.</span></span> <span data-ttu-id="3c842-268">따라서 파일 시스템이 중단의 영향을 받지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-268">Therefore the file system is not affected by the interruption.</span></span>

<span data-ttu-id="3c842-269">모든 데이터를 미디어에 성공적으로 쓴 후에는 FileX는 로그 항목의 정보를 따라 시스템 정보에 대한 변경 사항을 한 번에 하나씩 적용합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-269">After all the data is successfully written to the media, FileX then follows information in the log entries to applies the changes to system information, one entry at a time.</span></span> <span data-ttu-id="3c842-270">모든 시스템 정보를 미디어에 커밋한 후에는 로그 항목이 오류 허용 로그에서 제거됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-270">After all the system information is committed to the media, the log entries are removed from the fault tolerant log.</span></span> <span data-ttu-id="3c842-271">이 시점에서 FileX는 파일 업데이트 작업을 완료합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-271">At this point, FileX completes the file update operation.</span></span>

<span data-ttu-id="3c842-272">파일 업데이트 작업을 수행하는 동안 파일은 현재 위치에서 업데이트되지 않습니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-272">During file update operation, files are not updated in place.</span></span> <span data-ttu-id="3c842-273">내결함성 모듈은 데이터에 대한 섹터를 할당하여 새 데이터를 쓴 다음, 덮어쓸 데이터가 포함된 섹터를 제거하고, 관련 FAT 항목을 업데이트하여 새 섹터를 체인에 연결합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-273">The fault tolerant module allocates a sector for the data to write the new data into, and then remove the sector that contains the data to be overwritten, updating related FAT entries to link the new sector into the chian.</span></span> <span data-ttu-id="3c842-274">클러스터의 부분 데이터를 수정해야 하는 경우 FileX는 항상 새 클러스터를 할당하고, 업데이트된 데이터가 있는 이전 클러스터의 전체 데이터를 새 클러스터에 쓴 다음, 이전 클러스터를 제거합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-274">For situations in which partial data in a cluster needs to be modified, FileX always allocates new clusters, writes the entire data from the old clusters with updated data into the new clusters, then frees up the old clusters.</span></span> <span data-ttu-id="3c842-275">이렇게 하면 파일 업데이트가 중단된 경우에도 원본 파일이 그대로 유지됩니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-275">This guarantees that if the file update is interrupted, the original file is intact.</span></span> <span data-ttu-id="3c842-276">애플리케이션은 FileX 내결함성 보호 상태에서 파일의 데이터를 업데이트하려면 이전 데이터가 포함된 섹터를 제거하기 전에 새 데이터를 저장할 수 있는 충분한 여유 공간이 미디어에 있어야 함을 파악해야 합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-276">The application needs to be aware that under FileX fault tolerant protection, updating data in a file requires the media to have enough free space to hold new data before sectors with old data can be released.</span></span> <span data-ttu-id="3c842-277">미디어에 새 데이터를 저장할 충분한 공간이 없는 경우 업데이트 작업은 실패합니다.</span><span class="sxs-lookup"><span data-stu-id="3c842-277">If the media doesn't have enough space to hold new data, the update operation fails.</span></span>
