---
title: 챕터 1 - Azure RTOS NetX Duo FTP 소개
description: FTP(파일 전송 프로토콜)는 파일 전송을 위해 설계된 프로토콜입니다.
author: philmea
ms.author: philmea
ms.date: 07/14/2020
ms.topic: article
ms.service: rtos
ms.openlocfilehash: a36357ce486d5ba8a68b23c829de6c4b821dfb3cc62f47b0958ff32deaa2f7a7
ms.sourcegitcommit: 93d716cf7e3d735b18246d659ec9ec7f82c336de
ms.translationtype: HT
ms.contentlocale: ko-KR
ms.lasthandoff: 08/07/2021
ms.locfileid: "116791298"
---
# <a name="chapter-1---introduction-to-azure-rtos-netx-duo-ftp"></a>챕터 1 - Azure RTOS NetX Duo FTP 소개

FTP(파일 전송 프로토콜)는 파일 전송을 위해 설계된 프로토콜입니다. FTP는 신뢰할 수 있는 TCP(Transmission Control Protocol) 서비스를 사용하여 파일 전송 기능을 수행합니다. 따라서 FTP는 신뢰성이 높은 파일 전송 프로토콜입니다. 또한 FTP는 성능이 뛰어납니다. 실제 FTP 파일 전송은 전용 FTP 연결에서 이루어집니다. NetX Duo FTP는 IPv4 및 IPv6 네트워크를 모두 수용합니다. IPv6는 FTP 프로토콜을 직접 변경하지 않지만, 원본 NetX FTP API에서 IPv6를 수용하려면 몇 가지 부분을 변경해야 하며, 해당 내용은 이 문서에서 설명합니다.

## <a name="ftp-requirements"></a>FTP 요구 사항

NetX FTP 패키지가 제대로 작동하려면 NetX Duo가 필요합니다. 호스트 애플리케이션은 NetX 서비스 및 정기 작업을 실행하기 위한 IP 인스턴스를 만들어야 합니다. IPv6 네트워크를 통해 FTP 호스트 애플리케이션을 실행하는 경우 IP 작업에서 IPv6 및 ICMPv6를 사용하도록 설정해야 합니다. IPv6 또는 IPv4 네트워크에 TCP도 사용하도록 설정해야 합니다. IPv6 호스트 애플리케이션은 IPv6 API 및/또는 DHCPv6를 사용하여 링크로컬 및 글로벌 IPv6 주소를 설정해야 합니다. **챕터 2** 의 “작은 예제 시스템” 섹션에 있는 데모 프로그램은 이를 수행하는 방법을 보여줍니다.

FTP 서버와 클라이언트도 FileX 포함된 파일 시스템에서 사용할 수 있습니다. FileX를 사용할 수 없는 경우, 호스트 개발자는 filex_stub.h에서 제안하는 지침에 따라 해당 파일에 나열된 각 서비스를 정의하여 자체 파일 시스템을 구현하거나 대체할 수 있습니다. 이에 대해서는 이 가이드의 이후 섹션에서 설명합니다.

NetX FTP 패키지의 FTP 클라이언트 부분에는 추가 요구 사항이 없습니다.

NetX FTP 패키지의 FTP 서버 부분에는 여러 추가 요구 사항이 있습니다. 먼저 모든 클라이언트 FTP 명령 처리를 위해 TCP의 *잘 알려진 포트 21*, 모든 클라이언트 FTP 데이터 전송 처리를 위해 *잘 알려진 포트 20* 에 대한 완전한 액세스 권한이 필요합니다.

## <a name="ftp-constraints"></a>FTP 제약 조건

FTP 표준에는 파일 데이터 표현과 관련된 많은 옵션이 있습니다. NetX FTP는 스위치 옵션(예: ls –al)을 구현하지 않습니다. NetX FTP 서버는 연속 패킷이 아닌 단일 패킷에서 요청 및 해당 인수를 받아야 합니다.

UNIX 구현과 마찬가지로, NetX FTP는 다음과 같은 파일 형식 제약 조건을 가정합니다.

- 파일 유형: **이진**
- 파일 형식: **비 인쇄 전용**
- 파일 구조: **파일 구조만**

## <a name="ftp-file-names"></a>FTP 파일 이름

FTP 파일 이름은 대상 파일 시스템(일반적으로 FileX)의 형식이어야 합니다. 필요한 경우 전체 경로 정보를 포함하는 NULL 종료 ASCII 문자열이어야 합니다. NetX FTP 구현에서는 FTP 파일 이름 크기 제한이 지정되지 않습니다. 하지만 패킷 풀 페이로드 크기는 최대 경로 및/또는 파일 이름을 수용할 수 있어야 합니다.

## <a name="ftp-client-commands"></a>FTP 클라이언트 명령

FTP에는 연결을 열고 파일 및 디렉터리 작업을 수행하는 간편한 메커니즘이 있습니다. 기본적으로 TCP의 *잘 알려진 포트 21* 에서 연결이 성공적으로 설정된 후 클라이언트에서 실행되는 표준 FTP 명령 세트가 있습니다. 다음은 몇 가지 기본 FTP 명령입니다. IPv6를 통해 FTP를 실행하는 경우 유일한 차이점은 PORT 명령이 EPRT 명령으로 대체된다는 것입니다.

- CWD path *작업 디렉터리 변경*
- DELE filename *지정된 파일 이름 삭제*
- EPRT ip_address, port *IPv6 주소 및 클라이언트 데이터 포트 제공*
- EPSV *IPv6 수동 전송 모드 요청*
- LIST directory *디렉터리 목록 가져오기*
- MKD directory *새 디렉터리 만들기*
- NLST directory *디렉터리 목록 가져오기*
- NOOP *작업 없음, 성공 반환*
- PASS password *로그인 암호 제공*
- PASV *IPv4 수동 전송 모드 요청*
- PORT ip_address,port *IP 주소 및 클라이언트 데이터 포트 제공*
- PWD path *현재 디렉터리 경로 픽업*
- QUIT *클라이언트 연결 종료*
- RETR filename *지정된 파일 읽기*
- RMD directory *지정된 디렉터리 삭제*
- RNFR oldfilename *이름을 바꿀 파일 지정*
- RNTO newfilename *제공된 파일 이름으로 파일 이름 바꾸기*
- STOR filename *지정된 파일 쓰기*
- TYPE I *이진 파일 이미지 선택*
- USER username *로그인 사용자 이름 입력*

이러한 ASCII 명령은 NetX FTP 클라이언트 소프트웨어 내부에서 FTP 서버를 사용하는 FTP 작업을 수행하는 데 사용됩니다.

## <a name="ftp-server-responses"></a>FTP 서버 응답

FTP 서버가 클라이언트 요청을 처리한 후 ASCII 형식의 3자리로 코딩된 응답과 선택 사항인 ASCII 텍스트를 반환합니다. 이 숫자 응답은 FTP 클라이언트 소프트웨어가 작업 성공 또는 실패 여부를 확인하기 위해 사용됩니다. 다음은 클라이언트 요청에 대한 다양한 FTP 서버 응답 목록을 보여 줍니다.

**첫 번째 숫자 필드 의미**

- 1xx *긍정 예비 상태 - 또 다른 회신을 수신하는 중입니다*.
- 2xx *긍정 완료 상태*
- 3xx *긍정 예비 상태 - 또 다른 명령을 전송해야 합니다*.
- 4xx *임시 오류 조건*
- 5xx *오류 조건*

**두 번째 숫자 필드 의미**

- x0x *명령의 구문 오류*
- x1x *정보 메시지*
- x2x *연결 관련*
- x3x *인증 관련*
- x4x *지정되지 않음*
- x5x *파일 시스템 관련*

예를 들어 QUIT 명령을 사용하여 FTP 연결을 해제하는 클라이언트 요청은 일반적으로 서버에서 "221" 코드 응답을 받습니다(연결 해제가 완료된 경우).

## <a name="ftp-passive-transfer-mode"></a>FTP 수동 전송 모드

기본적으로 NetX Duo FTP 클라이언트는 활성 전송 모드를 사용하여 FTP 서버와 데이터 소켓을 통해 데이터를 교환합니다. 이에 대한 문제는 FTP 클라이언트에서 FTP 서버에 연결할 TCP 서버 소켓을 열어야 한다는 것입니다. 이는 가능한 보안 위험을 나타내며 클라이언트 방화벽에 의해 차단될 수 있습니다. 수동 전송 모드는 FTP 서버에서 데이터 연결에 TCP 서버 소켓을 만들도록 하므로 활성 전송 모드와 다릅니다. 이렇게 하면 (FTP 클라이언트에 대한) 보안 위험이 제거됩니다.

애플리케이션이 수동 데이터 전송을 사용하도록 설정하기 위해 두 번째 인수를 NX_TRUE로 설정하여 이전에 생성되었던 FTP 클라이언트에서 *nx_ftp_client_passive_mode_set* 를 호출합니다. 이후에 데이터를 전송하는 모든 후속 NetX Duo FTP 클라이언트 서비스(NLST, RETR, STOR)는 수동 전송 모드에서 시도됩니다.

FTP 클라이언트는 먼저 수동 명령(인수 없음), IPv4에 대한 PASV 명령 또는 IPv6에 대한 EPSV 명령을 보냅니다. FTP 서버에서 이 요청을 지원하면 PASV에 대해 227 "OK" 응답을 반환하고, EPSV에 대해 229 "OK" 응답을 반환합니다. 그런 다음, 클라이언트가 요청을 보냅니다(예: RETR). 서버에서 수동 전송 모드를 거부하는 경우 NetX Duo FTP 클라이언트 서비스는 오류 상태를 반환합니다.

수동 전송 모드를 사용하지 않도록 설정하고 활성 전송 모드를 반환하도록 애플리케이션에서 두 번째 인수가 NX_FALSE로 설정된 *nx_ftp_client_passive_mode_set* 를 호출합니다.

## <a name="ftp-communication"></a>FTP 통신

FTP 서버는 필드 클라이언트 요청에 대해 *잘 알려진 TCP 포트 21* 을 활용합니다. FTP 클라이언트는 사용 가능한 모든 TCP 포트를 이용할 수 있습니다. FTP 이벤트의 일반 시퀀스는 다음과 같습니다.

**FTP 파일 읽기 요청**:

1. 클라이언트가 서버 포트 21에 TCP 연결을 수행합니다.
1. 서버에서 신호 성공에 대한 "220" 응답을 보냅니다.
1. 클라이언트에서 "username"을 포함한 "USER" 메시지를 보냅니다.
1. 서버에서 신호 성공에 대한 "331" 응답을 보냅니다.
1. 클라이언트에서 "password"를 포함한 "PASS" 메시지를 보냅니다.
1. 서버에서 신호 성공에 대한 "230" 응답을 보냅니다.
1. 클라이언트에서 이진 전송에 대한 "TYPE I" 메시지를 보냅니다.
1. 서버에서 신호 성공에 대한 "200" 응답을 보냅니다.
1. *IPv4 애플리케이션*: 클라이언트에서 IP 주소 및 포트를 포함한 "PORT" 메시지를 보냅니다.<br />*IPv6 애플리케이션*: 클라이언트에서 IP 주소 및 포트를 포함한 "EPRT" 메시지를 보냅니다.
1. 서버에서 신호 성공에 대한 "200" 응답을 보냅니다.
1. 클라이언트에서 읽을 파일 이름을 포함한 "RETR" 메시지를 보냅니다.
1. 서버에서 데이터 소켓을 만들고 "PORT" 명령에 지정된 클라이언트 데이터 포트에 연결합니다.
1. 서버에서 "125" 응답을 보내 파일 읽기가 시작되었음을 나타냅니다.
1. 서버에서 데이터 연결을 통해 파일의 내용을 보냅니다. 이 프로세스는 파일이 완전히 전송될 때까지 계속됩니다.
1. 완료되면 서버에서 데이터 연결을 해제합니다.
1. 서버에서 파일 읽기에 성공했음을 나타내는 "250" 응답을 보냅니다.
1. 클라이언트에서 FTP 연결을 종료하기 위해 "QUIT"을 보냅니다.
1. 서버에서 신호 연결 해제에 성공했음을 나타내는 "221" 응답을 보냅니다.
1. 서버에서 FTP 연결을 해제합니다.

앞서 언급했듯이, IPv4를 통해 실행되는 FTP와 IPv6를 통해 실행되는 FTP의

유일한 차이점은 PORT 명령이 IPv6에서 EPRT 명령으로 대체된다는 점입니다.

FTP 클라이언트가 수동 전송 모드에서 읽기 요청을 수행하는 경우 명령 시퀀스는 다음과 같습니다(**굵게** 표시된 줄은 활성 전송 모드에서 단계가 다름을 의미함).

1. 클라이언트가 서버 포트 21에 TCP 연결을 수행합니다.
1. 서버에서 신호 성공에 대한 "220" 응답을 보냅니다.
1. 클라이언트에서 "username"을 포함한 "USER" 메시지를 보냅니다.
1. 서버에서 신호 성공에 대한 "331" 응답을 보냅니다.
1. 클라이언트에서 "password"를 포함한 "PASS" 메시지를 보냅니다.
1. 서버에서 신호 성공에 대한 "230" 응답을 보냅니다.
1. 클라이언트에서 이진 전송에 대한 "TYPE I" 메시지를 보냅니다.
1. 서버에서 신호 성공에 대한 "200" 응답을 보냅니다.
1. ***IPv4 애플리케이션:* 클라이언트에서 "PASV" 메시지를 보냅니다.**<br />**_IPv6 애플리케이션:_ 클라이언트에서 "EPSV" 메시지를 보냅니다.**
1. ***IPv4 애플리케이션:* 서버에서 성공을 나타내는 "227" 응답과 클라이언트가 연결해야 하는 IP 주소 및 포트를 보냅니다.**<br />**_IPv6 애플리케이션:_ 서버에서 성공을 나타내는 "229" 응답과 클라이언트가 연결해야 하는 IP 주소 및 포트를 보냅니다.**
1. 클라이언트에서 읽을 파일 이름을 포함한 "RETR" 메시지를 보냅니다.
1. **서버에서 데이터 서버 소켓을 만들고 10단계의 응답에 지정된 포트를 사용하여 이 소켓에서 클라이언트 연결 요청을 수신합니다.**
1. **서버에서 제어 소켓에 대해 파일 읽기가 시작되었음을 나타내는 "150" 응답을 보냅니다.**
1. 서버에서 데이터 연결을 통해 파일의 내용을 보냅니다. 이 프로세스는 파일이 완전히 전송될 때까지 계속됩니다.
1. 완료되면 서버에서 데이터 연결을 해제합니다.
1. **서버에서 제어 소켓에 대해 파일 읽기에 성공했음을 나타내는 "226" 응답을 보냅니다.**
1. 클라이언트에서 FTP 연결을 종료하기 위해 "QUIT"을 보냅니다.
1. 서버에서 신호 연결 해제에 성공했음을 나타내는 "221" 응답을 보냅니다.
1. 서버에서 FTP 연결을 해제합니다.

**FTP 쓰기 요청**:

1. 클라이언트가 서버 포트 21에 TCP 연결을 수행합니다.
1. 서버에서 신호 성공에 대한 "220" 응답을 보냅니다.
1. 클라이언트에서 "username"을 포함한 "USER" 메시지를 보냅니다.
1. 서버에서 신호 성공에 대한 "331" 응답을 보냅니다.
1. 클라이언트에서 "password"를 포함한 "PASS" 메시지를 보냅니다.
1. 서버에서 신호 성공에 대한 "230" 응답을 보냅니다.
1. 클라이언트에서 이진 전송에 대한 "TYPE I" 메시지를 보냅니다.
1. 서버에서 신호 성공에 대한 "200" 응답을 보냅니다.
1. *IPv4 애플리케이션*: 클라이언트에서 IP 주소 및 포트를 포함한 "PORT" 메시지를 보냅니다.<br />*IPv6 애플리케이션*: 클라이언트에서 IP 주소 및 포트를 포함한 "EPRT" 메시지를 보냅니다.
1. 서버에서 신호 성공에 대한 "200" 응답을 보냅니다.
1. 클라이언트에서 쓸 파일 이름을 포함한 "STOR" 메시지를 보냅니다.
1. 서버에서 데이터 소켓을 만들고 이전의 "EPRT" 또는 "PORT" 명령에 지정된 클라이언트 데이터 포트에 연결합니다.
1. 서버에서 파일 쓰기가 시작되었음을 나타내는 "125" 응답을 보냅니다.
1. 클라이언트에서 데이터 연결을 통해 파일의 내용을 보냅니다. 이 프로세스는 파일이 완전히 전송될 때까지 계속됩니다.
1. 완료되면 클라이언트에서 데이터 연결을 해제합니다.
1. 서버에서 파일 쓰기가 성공했음을 나타내는 "250" 응답을 보냅니다.
1. 클라이언트에서 FTP 연결을 종료하기 위해 "QUIT"을 보냅니다.
1. 서버에서 신호 연결 해제에 성공했음을 나타내는 "221" 응답을 보냅니다.
1. 서버에서 FTP 연결을 해제합니다.

FTP 클라이언트가 수동 전송 모드에서 쓰기 요청을 수행하는 경우 명령 시퀀스는 다음과 같습니다(**굵게** 표시된 줄은 활성 전송 모드에서 단계가 다름을 의미함).

1. 클라이언트가 서버 포트 21에 TCP 연결을 수행합니다.
1. 서버에서 신호 성공에 대한 "220" 응답을 보냅니다.
1. 클라이언트에서 "username"을 포함한 "USER" 메시지를 보냅니다.
1. 서버에서 신호 성공에 대한 "331" 응답을 보냅니다.
1. 클라이언트에서 "password"를 포함한 "PASS" 메시지를 보냅니다.
1. 서버에서 신호 성공에 대한 "230" 응답을 보냅니다.
1. 클라이언트에서 이진 전송에 대한 "TYPE I" 메시지를 보냅니다.
1. 서버에서 신호 성공에 대한 "200" 응답을 보냅니다.
1. ***IPv4 애플리케이션:* 클라이언트에서 "PASV" 메시지를 보냅니다.**<br />**_IPv6 애플리케이션:_ 클라이언트에서 "EPSV" 메시지를 보냅니다.**
1. ***IPv4 애플리케이션:* 서버에서 성공을 나타내는 "227" 응답과 클라이언트가 연결해야 하는 IP 주소 및 포트를 보냅니다.**<br />**_IPv6 애플리케이션:_ 서버에서 성공을 나타내는 "229" 응답과 클라이언트가 연결해야 하는 IP 주소 및 포트를 보냅니다.**
1. 클라이언트에서 쓸 파일 이름을 포함한 "STOR" 메시지를 보냅니다.
1. **서버에서 데이터 서버 소켓을 만들고 10단계의 응답에 지정된 포트를 사용하여 이 소켓에서 클라이언트 연결 요청을 수신합니다.**
1. **서버에서 제어 소켓에 대해 파일 쓰기가 시작되었음을 나타내는 "150" 응답을 보냅니다.**
1. 클라이언트에서 데이터 연결을 통해 파일의 내용을 보냅니다. 이 프로세스는 파일이 완전히 전송될 때까지 계속됩니다.
1. 완료되면 클라이언트에서 데이터 연결을 해제합니다.
1. **서버에서 제어 소켓에 대해 파일 쓰기에 성공했음을 나타내는 "226" 응답을 보냅니다.**
1. 클라이언트에서 FTP 연결을 종료하기 위해 "QUIT"을 보냅니다.
1. 서버에서 신호 연결 해제에 성공했음을 나타내는 "221" 응답을 보냅니다.
1. 서버에서 FTP 연결을 해제합니다.

## <a name="ftp-authentication"></a>FTP Authentication

FTP 연결이 이루어질 때마다 클라이언트는 서버는 *사용자 이름* 과 *암호* 를 제공해야 합니다. 일부 FTP 사이트에서는 특정 사용자 이름 및 암호 없이 FTP 액세스를 허용하는 *익명 FTP* 를 허용합니다. 이러한 유형의 연결에서는 사용자 이름에 "anonymous"를 입력해야 하며 암호는 전체 이메일 주소여야 합니다.

사용자는 로그인 및 로그아웃 인증 루틴이 포함된 NetX FTP를 제공해야 합니다. 이러한 작업은 ***nxd_ftp_server_create** _ 및 _*_nx_ftp_server_create_*_ 서비스 중에 제공되며, 암호 처리 중에 호출됩니다. 둘의 차이점은 로그인 및 로그아웃 인증 함수에 대한 _*_nxd_ftp_server_create_*_ 입력 함수 포인터가 NetX Duo 주소 유형으로 _*_NXD_ADDRESS_*_ 를 필요로 한다는 것입니다. 이 데이터 형식은 IPv4 또는 IPv6 주소 형식을 모두 포함하므로 이 함수가 IPv4 및 IPv6 네트워크를 모두 지원하는 "duo" 서비스가 됩니다. 로그인 및 로그아웃 인증 함수에 대한 _ *_nx_ftp_server_create_** 입력 함수 포인터는 ULONG IP 주소 형식을 필요로 합니다. 이 함수는 IPv4 네트워크로 제한됩니다. 개발자는 가능한 경우 항상 "duo" 서비스를 사용하는 것이 좋습니다.

*login* 함수가 NX_SUCCESS를 반환하는 경우 연결이 인증되고 FTP 작업이 허용됩니다. 반대로 *login* 함수가 NX_SUCCESS 이외의 것을 반환하는 경우 연결 시도가 거부됩니다.

## <a name="ftp-multi-thread-support"></a>FTP 다중 스레드 지원

NetX FTP 클라이언트 서비스는 다중 스레드에서 동시에 호출할 수 있습니다. 하지만 특정 FTP 클라이언트 인스턴에 대한 읽기 또는 쓰기 요청을 동일 스레드에서 순차적으로 수행할 수 있습니다.

## <a name="ftp-rfcs"></a>FTP RFC

NetX Duo FTP는 RFC 959, RFC 2428 및 관련 RFC를 준수합니다.
